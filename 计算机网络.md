# **计算机网络**

[TOC]

### 定义

将一个分散独立的==计算机系统（端系统）==，通过通信设备和线路连接起来，由软件实现==资源共享==和==信息传递==

计算机网络是互连`互联互通`的、自治`无主从关系`的计算机集合

---

### 功能

- 数据通信（连通性）
- 资源共享（硬件共享、软件共享、数据共享）
- ~分布式处理~
- ~提高可靠性~
- ……

---

### 组成

##### 组成部分 

硬件、软件、协议

##### 工作方式

- ###### 边缘部分

  >主机所在位置
  >
  >用户可以直接使用 
  >
  >>进行通信有两种方式
  >>
  >>- C/S方式
  >>
  >>- P2P方式

- ###### 核心部分

  > 为边缘部分提供服务

##### 功能组成

数据传输、资源共享

- ###### 通信子网

> 实现数据通信

- ###### 资源子网

> 实现资源共享和数据处理

---

### 网络分类

##### 按分布范围分

- 广域网（交换技术）
- 城域网
- 局域网（广播技术）
- 个人区域网

##### 按使用者分

- 公用网
- 专用网

##### 按交换技术分

- 电路交换
- 报文交换
- 分组交换

##### 按拓扑结构分

- 总线型
- 星型
- 环型
- 网状型（常用与广域网）

##### 按传输技术分

- 广播式网络（共享公共通信信道）所有人都要收到
- 点对点网络 使用==分组存储转发==和==路由选择==机制

---

### 标准

标准分类

- 法定标准（由权威机构制定的标准）OSI
- 事实标准（某些产品在竞争中占主流，久而久之，演化成标准）TCP/IP

RFC (Require For Comment) ——因特网标准的形式

---

### 性能指标

#### 速率

数据率或比特率

定义：连接在计算机网络上的主机在数字信道上传送数据位数的速率

速率是实时的，带宽是最大速率

单位：b/s，kb/s，Mb/s，Gb/s，Tb/s `每个单位的倍数是10^3`



#### 带宽

指单位时间内从网购中某一点到另一点所能通过的==最高数据率== 或 指网络设备所支持的最高速度

用来表示网络通信线路传输数据的能力

带宽只能影响单位时间在信道内传输的bit数，并不能影响bit的传输速度

`带宽单位与速率相同`



#### 吞吐量

表示在单位时间内通过某个网络或接口的数据量

吞吐量受网络带宽和额定速率的限制

`单位也与速率相同`



#### 时延

- 发送时延（传输时延）`高速链路指的是提高发送速率`

  > 从第一个比特到最后一个比特传输完毕所需时间
  >
  > 发送时延 = 数据长度 / 信道带宽

- 传播时延

  > 数据在信道上传输的所需时间
  >
  > 传播时延 = 信道长度 / 电磁波在信道上传播的速率 

- 排队时延

> 排队等待路由器可用所等的时间

- 处理时延

  > 路由器检查数据、找接口所需的时间



#### 时延带宽积

时延带宽积 = 传播时延 * 带宽 `单位bit` 描述的是数据量

指的是信道上此时此刻的比特量



#### 往返时延RTT

从发送方发送数据开始（发送方的第一个比特到信道上开始），到发送方接收到接受方的确认（接收到接收方接收到第一个比特的确认）

RTT越大，收到确认之前，传输的数据就越大

RTT

- 往返传播时延
- 末端处理时间



#### 利用率

- 信道利用率

> 有数据通过的时间 / 利用信道的时间

- 网络利用率

> 信道利用率加权平均值



### 分层结构

每层结构是独立的

下层要通过接口给上层提供服务

##### 协议

对等实体为数据交换所建立的规则、标准

- 语法：规定传输数据的格式
- 语义：规定所要完成的功能
- 同步：规定各种操作的顺序





#### 应用层

用户直接接触到的层级，用于向传输层发送数据



#### 传输层

接受应用层传过来的数据，为网络层提供支持的

**TCP协议和UDP协议就存在于此**，TCP协议能够保证数据包正确的传输给了对方（三次握手，四次挥手），UDP协议则不能确保数据的正确性，但性能会高。

当传输的数据大于TCP的最大报文长度（MSS）时，就会进行数据分块，每个数据块称为TCP段（TCP segment）

操作系统会给每个应用分配端口，（操作系统会给每个Web网页分页开辟一个临时端口），传输层传输时会携带端口信息



#### 网络层

负责通过IP地址寻找发送目标在网络中的所在位置（先匹配网络号，再寻找主机号）

**IP协议就存在于此**（作用：寻址+路由），网络层会将传输层送来的报文加上IP头部，如果报文大小超过MTU则会进一步切分报文再加上IP头部

IPv4：IP地址一共有2的4次方32位长，分为四段

IP地址有两个意义：

- 网络号：负责标识主机所在子网的编号
- 主机号：负责标识同一子网下不同的主机

需要配合**子网掩码**才能得到准确的IP地址

IP协议还有一个重要的功能**路由**，可以决定数据包下一步该往哪里走

IP协议的寻址就相当于导航，提供目的地的信息，路由就相当于操作方向盘，控制着报文该往哪条路径走



#### 链路层

服务于网络层，负责通过**MAC地址**寻找IP地址对应的确切主机

**ARP协议存在于此**

数据传输通常需要跨网络，这时候就需要路由器通过路由表计算出下一个目的地的IP地址，每个主机的网卡都有一个MAC地址，由链路层通过ARP协议找到目标地址的MAC地址，就可以识别主机位置



#### 物理层

负责把数据转化为电信号，为链路层服务

---

### HTTP协议

HTTP：超文本传输协议

HTTP协议是一个双向协议

**HTTP就是一个在计算机世界里专门在两点之间传输文字、图片、视频、音频等超文本数据的约定和规范**

#### 常见状态码

1xx：提示信息，协议的一种中间态

2xx：服务器成功处理了客户端的请求

> 200：一切正常，非HEAD请求，服务器返回的响应头内会有body数据
>
> 204：一切正常，与200类似，但响应头内没有数据
>
> 206：应用于HTTP的断点续传或分块下载，表示返回的body数据不是全部数据

3xx：重定向

> 301：永久重定向，说明请求的资源已经不存在了，需要改用新的URL进行访问
>
> 302：临时重定向，说明资源还在，但暂时需要用新的URL访问
>
> ==301和302中的响应头内会有location字段，说明要跳转的URL，浏览器会自动重定向到新的URL==
>
> 304：不存在跳转，用于缓存机制

4xx：客户端发送的报文有错误，服务器无法处理

> 400：客户端出现错误
>
> 403：服务器禁止访问资源，客户端请求没有错误
>
> 404：访问的服务器资源不存在

5xx：客户端请求正确，但是服务器内部错误

> 500：服务器内部错误
>
> 501：客户端请求的功能目前不支持，类似“敬请期待”的意思
>
> 502：访问后端服务器发生错误
>
> 503：服务器正忙，无法响应当前请求

#### 常见字段

host字段：请求时用于指定服务器域名

content-length字段：本次发送数据的长度

connection字段：常用于要求http持久连接（connection：keep-alive）

content-type：告诉客户端返回的数据格式



get和post的区别

get用于请求服务器的资源，图片、文字、页面等等

post用于向服务器提交数据、表单等等

##### 安全和幂等

安全：请求不会改变服务器数据

幂等：执行相同操作，返回的结果都是相同的

get请求是安全且幂等的，因为get请求不会改变服务器上的数据，且多次请求得到的结果都是相同的

post请求会改变服务器的数据，显然是不安全且不幂等的



#### http的特性

##### 优点

简单：报文格式基本都是header+body，而且头部信息都是以key-value形式存在，简单易于理解

灵活和易于扩展

> 灵活：http的各种请求方法、url、状态码、头字段都没有固定死，可以让开发人员自定义和扩充
>
> 易于扩展：Https在Http和TCP层之间加入了SSL/TLS安全传输层

应用广泛

##### 缺点

无状态

> 好处：服务器不需要记录太多信息，减轻了服务器的压力
>
> 坏处：没有记忆性，进行关联性操作时麻烦

不安全

> 明文传输
>
> 不验证身份，容易伪装
>
> 无法验证报文完整性，报文有可能被串改，植入广告

#### http性能

##### HTTP1.0

HTTP1.0每次请求都要建立一次TCP连接，非常影响性能

#### HTTP1.1

HTTP1.1允许了长链接，即如果双方没有任何一方提出要断开连接，则一直保持TCP连接。HTTP1.1还允许管道传输通信，即请求不必等响应回来后再发送。但响应还是会按顺序返回

但是HTTP1.1中存在

- 传输时不对请求和响应头进行压缩，只对body进行压缩，首部如果信息多就会形成延迟

- 对头堵塞现象，服务器如果响应慢，就会造成阻塞
- 发送冗余头部，相互发送每次都发送相同的头部
- 没有请求优先级控制
- 请求只能从客户端发出，服务器只能响应

##### HTTP2

http2进行了头部压缩，如果多次发送的头部信息是相同的或者相似的，就会通过HPACH算法，就会在客户端和服务器维护一张头信息表，所有字段都传到里面，匹配一个索引号。如果以后发送相同的就只发索引号。HPACH存在于HTTP和SSL/TLS协议之间

http2头信息和报文都采用了二进制格式，不再像http1.1的时候采用纯文本报文传输，这样计算机省去了将报文转成二进制的时间，直接解析二进制报文

http2采用用数据流传输，同一个数据包的可能是来自不同响应的。每个请求或者响应的所有数据包都称为一个数据流Stream，http2会对每个数据流进行编号，客户端发出的为奇数，服务器发出的为偶数。客户端还可以指定数据流的优先级

http2采取了多路复用，响应不必按照顺序，解决的对头阻塞

http2中服务器可以发推送，比如在请求HTML文件时，服务器可以推送JS和CSS给客户端

但是http2的TCP连接中存在多个HTTP请求，TCP协议是不清楚后面HTTP的请求个数的，一旦当前HTTP请求发生丢包，所有HTTP就要等这个包重传，就会发生阻塞

##### HTTP3

http3直接把TCP协议换成了UDP协议

#### https和http的区别

http是明文传输，而https在HTTP协议和TCP协议之间增加了SSL/TLS安全协议，使得报文可以加密传输

http的连接相对简单，传输只需要建立TCP三次握手，而https除了TCP三次握手还增加了SSL/TLS握手

http的默认端口为80，https默认端口为443





